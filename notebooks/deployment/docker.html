
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Containerization with Docker &#8212; 𝗜𝗻𝗲𝗳𝗳𝗶𝗰𝗶𝗲𝗻𝘁 𝗡𝗲𝘁𝘄𝗼𝗿𝗸𝘀</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="shortcut icon" href="../../_static/pone.0237978.g001.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Continuous Integration and Deployment Pipelines" href="cicd-pipelines.html" />
    <link rel="prev" title="Prediction Serving API" href="model-serving-api.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/pone.0237978.g001.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">𝗜𝗻𝗲𝗳𝗳𝗶𝗰𝗶𝗲𝗻𝘁 𝗡𝗲𝘁𝘄𝗼𝗿𝗸𝘀</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  MLOPS ZOOMCAMP
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../mlops/01-intro/notes.html">
   Preliminaries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mlops/02-mlflow/notes.html">
   Experiment Tracking and Model Management
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mlops/03-prefect/notes.html">
   Orchestration and ML Pipelines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mlops/04-deployment/notes.html">
   Model Deployment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mlops/05-monitoring/notes.html">
   Model Monitoring
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mlops/06-best-practices/notes.html">
   Best practices
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  MODEL DEPLOYMENT
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="production-code.html">
   Packaging Production Code
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="model-serving-api.html">
   Prediction Serving API
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Containerization with Docker
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cicd-pipelines.html">
   Continuous Integration and Deployment Pipelines
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  FUNDAMENTALS
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../fundamentals/pipelines.html">
   Modelling with Pipelines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../fundamentals/blending-stacking.html">
   Blending and Stacking
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../fundamentals/optuna.html">
   Hyperparameter Optimization using Optuna
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../fundamentals/missing.html">
   Handling Missing Values
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  DEEP LEARNING
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../fundamentals/backpropagation.html">
   Backpropagation on DAGs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tensorflow/01-tensorflow-nn.html">
   TensorFlow Datasets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tensorflow/02-tensorflow-mechanics.html">
   Mechanics of TensorFlow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tensorflow/03-tensorflow-activations.html">
   Activation Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tensorflow/04-tensorflow-optim-init.html">
   Initialization and Optimization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tensorflow/05-tensorflow-cnn.html">
   Convolutional Neural Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tensorflow/06-tensorflow-rnns.html">
   Recurrent Neural Networks
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/notebooks/deployment/docker.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/particle1331/inefficient-networks"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/particle1331/inefficient-networks/issues/new?title=Issue%20on%20page%20%2Fnotebooks/deployment/docker.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#getting-started">
   Getting started
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dockerfile">
   Dockerfile
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-containers">
   Running containers
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deploying-to-the-cloud">
   Deploying to the cloud
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#initialization">
     Initialization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#testing-locally">
     Testing locally
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#creating-the-environment">
     Creating the environment
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#making-a-request">
     Making a request
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#terminating-the-environment">
     Terminating the environment
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-balancing">
     Load balancing
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Containerization with Docker</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#getting-started">
   Getting started
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dockerfile">
   Dockerfile
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-containers">
   Running containers
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deploying-to-the-cloud">
   Deploying to the cloud
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#initialization">
     Initialization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#testing-locally">
     Testing locally
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#creating-the-environment">
     Creating the environment
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#making-a-request">
     Making a request
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#terminating-the-environment">
     Terminating the environment
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-balancing">
     Load balancing
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="containerization-with-docker">
<h1>Containerization with Docker<a class="headerlink" href="#containerization-with-docker" title="Permalink to this headline">¶</a></h1>
<p><img alt="Status" src="https://img.shields.io/static/v1.svg?label=Status&amp;message=Finished&amp;color=brightgreen" />
<a class="reference external" href="https://github.com/particle1331/inefficient-networks/blob/master/docs/notebooks/deployment/docker.ipynb"><img alt="Source" src="https://img.shields.io/static/v1.svg?label=GitHub&amp;message=Source&amp;color=181717&amp;logo=GitHub" /></a>
<a class="reference external" href="https://github.com/particle1331/inefficient-networks"><img alt="Stars" src="https://img.shields.io/github/stars/particle1331/inefficient-networks?style=social" /></a></p>
<hr class="docutils" />
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>𝗔𝘁𝘁𝗿𝗶𝗯𝘂𝘁𝗶𝗼𝗻: Builds on Week 5: Deploying Machine Learning Models of the ML Zoomcamp (2021). (github.com/alexeygrigorev/mlbookcamp-code/tree/master/course-zoomcamp/05-deployment)
</pre></div>
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Docker takes virtual environments one step further by isolating the entire application from the rest of the infrastructure of your host machine. Recall that to resolve conflicts with dependencies, we usually create multiple virtual environments for each service. Instead, we can create separate <strong>containers</strong> for each service using Docker.</p>
<p>Containers are allows services to run isolated from each other. This is nice especially if the application have side-effects that can affect other services or the host. Moreover, containers can be run anywhere (i.e. any x86 server running a modern Linux kernel) with the same standard behavior. For example, we will show how to deploy the <a class="reference external" href="https://particle1331.github.io/inefficient-networks/notebooks/deployment/model-serving-api.html">Prediction Serving API</a> in the cloud using AWS Elastic Beanstalk.</p>
<p><strong>Readings</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="https://mlbookcamp.com/article/aws">Creating an AWS Account</a></p></li>
<li><p><a class="reference external" href="https://jfrog.com/knowledge-base/a-beginners-guide-to-understanding-and-building-docker-images/#products">A Beginner’s Guide to Understanding and Building Docker Images</a></p></li>
<li><p><a class="reference external" href="https://aws.amazon.com/elasticbeanstalk/details/">AWS Elastic Beanstalk Features</a></p></li>
</ul>
</div>
<div class="section" id="getting-started">
<h2>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<p>Pulling <code class="docutils literal notranslate"><span class="pre">python-3.8.12-slim</span></code>, which is a small, optimized Docker image that runs Python 3.8.12 from Docker Hub. We run this with <code class="docutils literal notranslate"><span class="pre">-it</span></code> so Python runs in interactive mode and <code class="docutils literal notranslate"><span class="pre">--rm</span></code> so that the image will be deleted after exiting.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run -it --rm python:3.8.12-slim
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Unable</span> <span class="n">to</span> <span class="n">find</span> <span class="n">image</span> <span class="s1">&#39;python:3.8.12-slim&#39;</span> <span class="n">locally</span>
<span class="mf">3.8.12</span><span class="o">-</span><span class="n">slim</span><span class="p">:</span> <span class="n">Pulling</span> <span class="kn">from</span> <span class="nn">library</span><span class="o">/</span><span class="n">python</span>
<span class="mi">279</span><span class="n">a020076a7</span><span class="p">:</span> <span class="n">Pull</span> <span class="n">complete</span>
<span class="mi">035530</span><span class="n">c61301</span><span class="p">:</span> <span class="n">Pull</span> <span class="n">complete</span>
<span class="mi">430</span><span class="n">f5ca6cd82</span><span class="p">:</span> <span class="n">Pull</span> <span class="n">complete</span>
<span class="mi">594</span><span class="n">f692a6b57</span><span class="p">:</span> <span class="n">Pull</span> <span class="n">complete</span>
<span class="mi">70</span><span class="n">b1dc4462d0</span><span class="p">:</span> <span class="n">Pull</span> <span class="n">complete</span>
<span class="n">Digest</span><span class="p">:</span> <span class="n">sha256</span><span class="p">:</span><span class="n">a2d8844be9a3d5df8cd64c11bba476156cbfe5991db643c83e88ae383c15b5d0</span>
<span class="n">Status</span><span class="p">:</span> <span class="n">Downloaded</span> <span class="n">newer</span> <span class="n">image</span> <span class="k">for</span> <span class="n">python</span><span class="p">:</span><span class="mf">3.8.12</span><span class="o">-</span><span class="n">slim</span>
<span class="n">Python</span> <span class="mf">3.8.12</span> <span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="n">Mar</span>  <span class="mi">1</span> <span class="mi">2022</span><span class="p">,</span> <span class="mi">21</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">32</span><span class="p">)</span>
<span class="p">[</span><span class="n">GCC</span> <span class="mf">10.2.1</span> <span class="mi">20210110</span><span class="p">]</span> <span class="n">on</span> <span class="n">linux</span>
<span class="n">Type</span> <span class="s2">&quot;help&quot;</span><span class="p">,</span> <span class="s2">&quot;copyright&quot;</span><span class="p">,</span> <span class="s2">&quot;credits&quot;</span> <span class="ow">or</span> <span class="s2">&quot;license&quot;</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span><span class="o">.</span>
<span class="o">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>We can specify the entry point to <code class="docutils literal notranslate"><span class="pre">bash</span></code> so we can access the terminal:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run -it --rm --entrypoint<span class="o">=</span>bash python:3.8.12-slim
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root@fc40952e1b70:/# ls
bin   dev  home  media	opt   root  sbin  sys  usr
boot  etc  lib	 mnt	proc  run   srv   tmp  var
root@fc40952e1b70:/#
</pre></div>
</div>
</div>
<div class="section" id="dockerfile">
<h2>Dockerfile<a class="headerlink" href="#dockerfile" title="Permalink to this headline">¶</a></h2>
<p>Docker can build images automatically by reading the instructions from a <code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code>. This contains all the commands a user could call on the command line to assemble an image. We will save our <code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code> in the root of <a class="reference external" href="https://github.com/particle1331/model-deployment/tree/eb/api"><code class="docutils literal notranslate"><span class="pre">model-deployment/api</span></code></a>. Note that we switch to <code class="docutils literal notranslate"><span class="pre">python:3.9.12-slim</span></code> to match the development environment of our prediction serving API.</p>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p><a class="reference external" href="https://github.com/particle1331/model-deployment/blob/eb/api/Dockerfile"><code class="docutils literal notranslate"><span class="pre">api/Dockerfile</span></code></a></p>
</div>
<div class="highlight-Dockerfile notranslate"><div class="highlight"><pre><span></span><span class="k">FROM</span><span class="w"> </span><span class="s">python:3.9.12-slim</span>

<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>

<span class="k">COPY</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;*.py&quot;</span>, <span class="s2">&quot;*.txt&quot;</span>, <span class="s2">&quot;./&quot;</span><span class="o">]</span>

<span class="k">COPY</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;app&quot;</span>, <span class="s2">&quot;./app/&quot;</span><span class="o">]</span>

<span class="k">RUN</span><span class="w"> </span>pip install -r requirements.txt

<span class="k">EXPOSE</span><span class="w"> </span><span class="s">8000</span>

<span class="k">ENTRYPOINT</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;uvicorn&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;app.main:app&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;--host&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;--port&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;8000&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>This sets <code class="docutils literal notranslate"><span class="pre">app</span></code> as the working directory which will create it and <code class="docutils literal notranslate"><span class="pre">cd</span></code> the terminal to it. The next statement copies the contents of the <code class="docutils literal notranslate"><span class="pre">api</span></code> directory in the host, that is in the same directory as our <code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code>, into the current directory in the container which is <code class="docutils literal notranslate"><span class="pre">app</span></code>. Then, dependencies are installed and port <code class="docutils literal notranslate"><span class="pre">8000</span></code> is exposed to the host. Finally, the uvicorn server at <code class="docutils literal notranslate"><span class="pre">0.0.0.0:8000</span></code> is set as the container’s default entry point.</p>
</div>
<div class="section" id="running-containers">
<h2>Running containers<a class="headerlink" href="#running-containers" title="Permalink to this headline">¶</a></h2>
<p>To build the image from the <code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code> in the same directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker build -t service .
</pre></div>
</div>
<p>Here <code class="docutils literal notranslate"><span class="pre">-t</span></code> means tag which we set to <code class="docutils literal notranslate"><span class="pre">service</span></code>. Note that while the port <code class="docutils literal notranslate"><span class="pre">8000</span></code> of the container is exposed to the host, we still have to connect this to the host’s port <code class="docutils literal notranslate"><span class="pre">8000</span></code> which is accessed by the browser. We do this below in running the container with <code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">8000:8000</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run -it --rm -p <span class="m">8000</span>:8000 service
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>INFO:     Started server process [1]
2022-05-11 16:30:55.668 | INFO     | uvicorn.server:serve:75 - Started server process [1]
INFO:     Waiting for application startup.
2022-05-11 16:30:55.668 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
INFO:     Application startup complete.
2022-05-11 16:30:55.668 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
2022-05-11 16:30:55.668 | INFO     | uvicorn.server:_log_started_message:206 - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
</pre></div>
</div>
<div class="figure align-default" id="id1">
<a class="reference internal image-reference" href="../../_images/docker-host.png"><img alt="../../_images/docker-host.png" src="../../_images/docker-host.png" style="width: 30em;" /></a>
<p class="caption"><span class="caption-number">Fig. 47 </span><span class="caption-text">Connecting the container ports with localhost ports.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<p>Setting the entrypoint to <code class="docutils literal notranslate"><span class="pre">bash</span></code> to see the files inside of the container:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run -it --rm --entrypoint<span class="o">=</span>bash service
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root@35864429a154:/app# ls
Procfile  mypy.ini	    runtime.txt		   tests
app	  requirements.txt  test_requirements.txt  tox.ini
root@35864429a154:/app#
</pre></div>
</div>
</div>
<div class="section" id="deploying-to-the-cloud">
<h2>Deploying to the cloud<a class="headerlink" href="#deploying-to-the-cloud" title="Permalink to this headline">¶</a></h2>
<p>In this section, we deploy our application to the cloud using AWS Elastic Beanstalk (EB). Using this, we can simply upload our code and EB automatically handles the deployment, from capacity provisioning, load balancing, and automatic scaling to web application health monitoring. Regarding pricing, there is no additional charge for EB: what you pay for are the AWS resources that are created to store and run your web application, like Amazon S3 buckets and Amazon EC2 instances.</p>
<p>This section requires one to have an AWS account and an IAM user in this account. This can be done pretty quickly by following <a class="reference external" href="https://mlbookcamp.com/article/aws">this article</a>. After this, we have to install the EB CLI:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install awsebcli
</pre></div>
</div>
<div class="section" id="initialization">
<h3>Initialization<a class="headerlink" href="#initialization" title="Permalink to this headline">¶</a></h3>
<p>Initializing our EB application. Setting the platform <code class="docutils literal notranslate"><span class="pre">-p</span></code> to <code class="docutils literal notranslate"><span class="pre">docker</span></code> for obvious reasons, the region <code class="docutils literal notranslate"><span class="pre">-r</span></code> to <code class="docutils literal notranslate"><span class="pre">us-east-1</span></code> and the name of the application as <code class="docutils literal notranslate"><span class="pre">house-prices</span></code>. This requires IAM user credentials which we enter in the terminal.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>eb init -p docker -r us-east-1 house-prices
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>You have not yet set up your credentials or your credentials are incorrect
You must provide your credentials.
(aws-access-id): *********
(aws-secret-key): ***************************
Application house-prices has been created.
</pre></div>
</div>
<p>Notice this creates a <code class="docutils literal notranslate"><span class="pre">.elasticbeanstalk</span></code> directory containing a <code class="docutils literal notranslate"><span class="pre">config.yml</span></code> file:</p>
<div class="highlight-YAML notranslate"><div class="highlight"><pre><span></span><span class="nt">branch-defaults</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">default</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w"></span>
<span class="nt">global</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">application_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">house-prices</span><span class="w"></span>
<span class="w">  </span><span class="nt">branch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w"></span>
<span class="w">  </span><span class="nt">default_ec2_keyname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w"></span>
<span class="w">  </span><span class="nt">default_platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Docker</span><span class="w"></span>
<span class="w">  </span><span class="nt">default_region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-east-1</span><span class="w"></span>
<span class="w">  </span><span class="nt">include_git_submodules</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">  </span><span class="nt">instance_profile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w"></span>
<span class="w">  </span><span class="nt">platform_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w"></span>
<span class="w">  </span><span class="nt">platform_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w"></span>
<span class="w">  </span><span class="nt">profile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eb-cli</span><span class="w"></span>
<span class="w">  </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w"></span>
<span class="w">  </span><span class="nt">sc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w"></span>
<span class="w">  </span><span class="nt">workspace_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Application</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="testing-locally">
<h3>Testing locally<a class="headerlink" href="#testing-locally" title="Permalink to this headline">¶</a></h3>
<p>It’s always good to test run the container locally in EB:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>eb <span class="nb">local</span> run --port <span class="m">8000</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>3.9.12-slim: Pulling from library/python
dfdd5ffb2577: Already exists
22d252b4015f: Already exists
38a20a308c16: Already exists
74b110b743da: Already exists
573e544d3cdf: Already exists
Digest: sha256:49082c5b5851e62d5daa510b65fe1120b295ae08a96d7f2cb854f2aa054b5939
Status: Downloaded newer image for python:3.9.12-slim
docker.io/library/python:3.9.12-slim
#1 [internal] load build definition from Dockerfile
#1 sha256:acee64af890dcf198eaccfc920f8dfb2cf1918b27a4851b90cb764e113295108
#1 transferring dockerfile: 37B 0.0s done
#1 DONE 0.1s
#2 [internal] load .dockerignore
#2 sha256:46314d5fc4c9248a818ba2a1b91451a6b08b21e730c78edc9c9952952e7d4421
#2 transferring context: 34B done
#2 DONE 0.0s
#3 [internal] load metadata for docker.io/library/python:3.9.12-slim
#3 sha256:c1f4e52590624a81c4bc4ec7e3ed4861d41ab781ab36aaf259f7f7767d36f68c
#3 DONE 0.0s
#4 [1/5] FROM docker.io/library/python:3.9.12-slim
#4 sha256:6776e43cfb11ad7ef6edd8ab8ef9d3899c912fd1fdb680b44fda719e54ccf196
#4 DONE 0.0s
#6 [internal] load build context
#6 sha256:bb9f786c56a5eb86bb5c84216cbe2897c14ca0a3d64efcfd01c555b11e3e65cd
#6 transferring context: 916B 0.0s done
#6 DONE 0.0s
#8 [4/5] COPY [app, ./app/]
#8 sha256:4f55637d9c3689c282b25ba0444f63b0c83ac448d6b9103fef3be1a660fc72a8
#8 CACHED
#7 [3/5] COPY [*.py, *.txt, ./]
#7 sha256:128f400076c6f3660053196b9faf8de680097f2c514447e5729eb65cccdd3916
#7 CACHED
#5 [2/5] WORKDIR /app
#5 sha256:51924f7a2648c15715590a60e237a35d77e1c14c70c8f66a2f7089d2eec93a33
#5 CACHED
#9 [5/5] RUN pip install -r requirements.txt
#9 sha256:13a22462bc4dcec6b6acec1628de97a6a0779be00a56074fb4f62b966ce8373b
#9 CACHED
#10 exporting to image
#10 sha256:e8c613e07b0b7ff33893b694f7759a10d42e180f2b4dc349fb57dc6b71dcab00
#10 exporting layers done
#10 writing image sha256:cf6140074279c0ec497e6d016fb8588b38b6dbd8c96cf3807d65940c76fddabe done
#10 naming to docker.io/library/jg71b5:may6ra done
#10 DONE 0.0s
Use &#39;docker scan&#39; to run Snyk tests against images to find vulnerabilities and learn how to fix them
INFO:     Started server process [1]
2022-05-12 16:56:37.551 | INFO     | uvicorn.server:serve:75 - Started server process [1]
INFO:     Waiting for application startup.
2022-05-12 16:56:37.552 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
INFO:     Application startup complete.
2022-05-12 16:56:37.555 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
2022-05-12 16:56:37.572 | INFO     | uvicorn.server:_log_started_message:206 - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
</pre></div>
</div>
</div>
<div class="section" id="creating-the-environment">
<h3>Creating the environment<a class="headerlink" href="#creating-the-environment" title="Permalink to this headline">¶</a></h3>
<p>Since the app works with EB locally, we can now create an actual EB environment in the cloud that underlies the web application:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>eb create house-prices-env
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Creating application version archive &quot;app-220513_010945910655&quot;.
Uploading: [##################################################] 100% Done...
Environment details for: house-prices-env
  Application name: house-prices
  Region: us-east-1
  Deployed Version: app-220513_010945910655
  Environment ID: e-vcacgx5qpw
  Platform: arn:aws:elasticbeanstalk:us-east-1::platform/Docker running on 64bit Amazon Linux 2/3.4.15
  Tier: WebServer-Standard-1.0
  CNAME: UNKNOWN
  Updated: 2022-05-12 17:10:55.488000+00:00
Printing Status:
2022-05-12 17:10:53    INFO    createEnvironment is starting.
2022-05-12 17:10:55    INFO    Using elasticbeanstalk-us-east-1-886789456404 as Amazon S3 storage bucket for environment data.
2022-05-12 17:11:21    INFO    Created security group named: sg-0079e2cdd92f7bd73
2022-05-12 17:11:36    INFO    Created load balancer named: awseb-e-v-AWSEBLoa-1E6LZRJC4OG9G
2022-05-12 17:11:36    INFO    Created security group named: awseb-e-vcacgx5qpw-stack-AWSEBSecurityGroup-16CWEUUKXFVWK
2022-05-12 17:11:36    INFO    Created Auto Scaling launch configuration named: awseb-e-vcacgx5qpw-stack-AWSEBAutoScalingLaunchConfiguration-2fyUMTUX8xJC
2022-05-12 17:13:11    INFO    Created Auto Scaling group named: awseb-e-vcacgx5qpw-stack-AWSEBAutoScalingGroup-SH3I567DJCWT
2022-05-12 17:13:11    INFO    Waiting for EC2 instances to launch. This may take a few minutes.
2022-05-12 17:13:11    INFO    Created Auto Scaling group policy named: arn:aws:autoscaling:us-east-1:886789456404:scalingPolicy:c67fd119-c153-45b7-abf0-a53e04cdcb2a:autoScalingGroupName/awseb-e-vcacgx5qpw-stack-AWSEBAutoScalingGroup-SH3I567DJCWT:policyName/awseb-e-vcacgx5qpw-stack-AWSEBAutoScalingScaleUpPolicy-140KQ45K015EH
2022-05-12 17:13:11    INFO    Created Auto Scaling group policy named: arn:aws:autoscaling:us-east-1:886789456404:scalingPolicy:9532adfe-20c6-4892-9e65-33cad550506c:autoScalingGroupName/awseb-e-vcacgx5qpw-stack-AWSEBAutoScalingGroup-SH3I567DJCWT:policyName/awseb-e-vcacgx5qpw-stack-AWSEBAutoScalingScaleDownPolicy-1W6BQSN057XIR
2022-05-12 17:13:11    INFO    Created CloudWatch alarm named: awseb-e-vcacgx5qpw-stack-AWSEBCloudwatchAlarmHigh-L6AEUYI9GTPI
2022-05-12 17:13:11    INFO    Created CloudWatch alarm named: awseb-e-vcacgx5qpw-stack-AWSEBCloudwatchAlarmLow-1IPO2R5GWMUVZ
2022-05-12 17:14:59    INFO    Instance deployment completed successfully.
2022-05-12 17:15:04    INFO    Application available at house-prices-env.eba-kxppppph.us-east-1.elasticbeanstalk.com.
2022-05-12 17:15:09    INFO    Successfully launched environment: house-prices-env
</pre></div>
</div>
<div class="figure align-default" id="id2">
<img alt="../../_images/ebhome.png" src="../../_images/ebhome.png" />
<p class="caption"><span class="caption-number">Fig. 48 </span><span class="caption-text">The prediction serving API can now be accessed using the internet.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="id3">
<img alt="../../_images/eb-ui.png" src="../../_images/eb-ui.png" />
<p class="caption"><span class="caption-number">Fig. 49 </span><span class="caption-text">Elastic Beanstalk web UI.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="id4">
<img alt="../../_images/eb-ui2.png" src="../../_images/eb-ui2.png" />
<p class="caption"><span class="caption-number">Fig. 50 </span><span class="caption-text">Dashboard for the prediction serving API web app environment showing logs and health. Here the application is being terminated.</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="making-a-request">
<h3>Making a request<a class="headerlink" href="#making-a-request" title="Permalink to this headline">¶</a></h3>
<p>Let us try making a request for a house price prediction given input data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">inputs</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;MSSubClass&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
      <span class="s2">&quot;MSZoning&quot;</span><span class="p">:</span> <span class="s2">&quot;RH&quot;</span><span class="p">,</span>
      <span class="s2">&quot;LotFrontage&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
      <span class="s2">&quot;LotArea&quot;</span><span class="p">:</span> <span class="mi">11622</span><span class="p">,</span>
      <span class="s2">&quot;Street&quot;</span><span class="p">:</span> <span class="s2">&quot;Pave&quot;</span><span class="p">,</span>
      <span class="s2">&quot;LotShape&quot;</span><span class="p">:</span> <span class="s2">&quot;Reg&quot;</span><span class="p">,</span>
      <span class="s2">&quot;LandContour&quot;</span><span class="p">:</span> <span class="s2">&quot;Lvl&quot;</span><span class="p">,</span>
      <span class="s2">&quot;Utilities&quot;</span><span class="p">:</span> <span class="s2">&quot;AllPub&quot;</span><span class="p">,</span>
      <span class="s2">&quot;LotConfig&quot;</span><span class="p">:</span> <span class="s2">&quot;Inside&quot;</span><span class="p">,</span>
      <span class="s2">&quot;LandSlope&quot;</span><span class="p">:</span> <span class="s2">&quot;Gtl&quot;</span><span class="p">,</span>
      <span class="s2">&quot;Neighborhood&quot;</span><span class="p">:</span> <span class="s2">&quot;NAmes&quot;</span><span class="p">,</span>
      <span class="s2">&quot;Condition1&quot;</span><span class="p">:</span> <span class="s2">&quot;Feedr&quot;</span><span class="p">,</span>
      <span class="s2">&quot;Condition2&quot;</span><span class="p">:</span> <span class="s2">&quot;Norm&quot;</span><span class="p">,</span>
      <span class="s2">&quot;BldgType&quot;</span><span class="p">:</span> <span class="s2">&quot;1Fam&quot;</span><span class="p">,</span>
      <span class="s2">&quot;HouseStyle&quot;</span><span class="p">:</span> <span class="s2">&quot;1Story&quot;</span><span class="p">,</span>
      <span class="s2">&quot;OverallQual&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
      <span class="s2">&quot;OverallCond&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
      <span class="s2">&quot;YearBuilt&quot;</span><span class="p">:</span> <span class="mi">1961</span><span class="p">,</span>
      <span class="s2">&quot;YearRemodAdd&quot;</span><span class="p">:</span> <span class="mi">1961</span><span class="p">,</span>
      <span class="s2">&quot;RoofStyle&quot;</span><span class="p">:</span> <span class="s2">&quot;Gable&quot;</span><span class="p">,</span>
      <span class="s2">&quot;RoofMatl&quot;</span><span class="p">:</span> <span class="s2">&quot;CompShg&quot;</span><span class="p">,</span>
      <span class="s2">&quot;Exterior1st&quot;</span><span class="p">:</span> <span class="s2">&quot;VinylSd&quot;</span><span class="p">,</span>
      <span class="s2">&quot;Exterior2nd&quot;</span><span class="p">:</span> <span class="s2">&quot;VinylSd&quot;</span><span class="p">,</span>
      <span class="s2">&quot;MasVnrType&quot;</span><span class="p">:</span> <span class="s2">&quot;None&quot;</span><span class="p">,</span>
      <span class="s2">&quot;MasVnrArea&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s2">&quot;ExterQual&quot;</span><span class="p">:</span> <span class="s2">&quot;TA&quot;</span><span class="p">,</span>
      <span class="s2">&quot;ExterCond&quot;</span><span class="p">:</span> <span class="s2">&quot;TA&quot;</span><span class="p">,</span>
      <span class="s2">&quot;Foundation&quot;</span><span class="p">:</span> <span class="s2">&quot;CBlock&quot;</span><span class="p">,</span>
      <span class="s2">&quot;BsmtQual&quot;</span><span class="p">:</span> <span class="s2">&quot;TA&quot;</span><span class="p">,</span>
      <span class="s2">&quot;BsmtCond&quot;</span><span class="p">:</span> <span class="s2">&quot;TA&quot;</span><span class="p">,</span>
      <span class="s2">&quot;BsmtExposure&quot;</span><span class="p">:</span> <span class="s2">&quot;No&quot;</span><span class="p">,</span>
      <span class="s2">&quot;BsmtFinType1&quot;</span><span class="p">:</span> <span class="s2">&quot;Rec&quot;</span><span class="p">,</span>
      <span class="s2">&quot;BsmtFinSF1&quot;</span><span class="p">:</span> <span class="mi">468</span><span class="p">,</span>
      <span class="s2">&quot;BsmtFinType2&quot;</span><span class="p">:</span> <span class="s2">&quot;LwQ&quot;</span><span class="p">,</span>
      <span class="s2">&quot;BsmtFinSF2&quot;</span><span class="p">:</span> <span class="mi">144</span><span class="p">,</span>
      <span class="s2">&quot;BsmtUnfSF&quot;</span><span class="p">:</span> <span class="mi">270</span><span class="p">,</span>
      <span class="s2">&quot;TotalBsmtSF&quot;</span><span class="p">:</span> <span class="mi">882</span><span class="p">,</span>
      <span class="s2">&quot;Heating&quot;</span><span class="p">:</span> <span class="s2">&quot;GasA&quot;</span><span class="p">,</span>
      <span class="s2">&quot;HeatingQC&quot;</span><span class="p">:</span> <span class="s2">&quot;TA&quot;</span><span class="p">,</span>
      <span class="s2">&quot;CentralAir&quot;</span><span class="p">:</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span>
      <span class="s2">&quot;Electrical&quot;</span><span class="p">:</span> <span class="s2">&quot;SBrkr&quot;</span><span class="p">,</span>
      <span class="s2">&quot;FirstFlrSF&quot;</span><span class="p">:</span> <span class="mi">896</span><span class="p">,</span>
      <span class="s2">&quot;SecondFlrSF&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s2">&quot;LowQualFinSF&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s2">&quot;GrLivArea&quot;</span><span class="p">:</span> <span class="mi">896</span><span class="p">,</span>
      <span class="s2">&quot;BsmtFullBath&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s2">&quot;BsmtHalfBath&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s2">&quot;FullBath&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="s2">&quot;HalfBath&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s2">&quot;BedroomAbvGr&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="s2">&quot;KitchenAbvGr&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="s2">&quot;KitchenQual&quot;</span><span class="p">:</span> <span class="s2">&quot;TA&quot;</span><span class="p">,</span>
      <span class="s2">&quot;TotRmsAbvGrd&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
      <span class="s2">&quot;Functional&quot;</span><span class="p">:</span> <span class="s2">&quot;Typ&quot;</span><span class="p">,</span>
      <span class="s2">&quot;Fireplaces&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s2">&quot;GarageType&quot;</span><span class="p">:</span> <span class="s2">&quot;Attchd&quot;</span><span class="p">,</span>
      <span class="s2">&quot;GarageYrBlt&quot;</span><span class="p">:</span> <span class="mi">1961</span><span class="p">,</span>
      <span class="s2">&quot;GarageFinish&quot;</span><span class="p">:</span> <span class="s2">&quot;Unf&quot;</span><span class="p">,</span>
      <span class="s2">&quot;GarageCars&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="s2">&quot;GarageArea&quot;</span><span class="p">:</span> <span class="mi">730</span><span class="p">,</span>
      <span class="s2">&quot;GarageQual&quot;</span><span class="p">:</span> <span class="s2">&quot;TA&quot;</span><span class="p">,</span>
      <span class="s2">&quot;GarageCond&quot;</span><span class="p">:</span> <span class="s2">&quot;TA&quot;</span><span class="p">,</span>
      <span class="s2">&quot;PavedDrive&quot;</span><span class="p">:</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span>
      <span class="s2">&quot;WoodDeckSF&quot;</span><span class="p">:</span> <span class="mi">140</span><span class="p">,</span>
      <span class="s2">&quot;OpenPorchSF&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s2">&quot;EnclosedPorch&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s2">&quot;ThreeSsnPortch&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s2">&quot;ScreenPorch&quot;</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span>
      <span class="s2">&quot;PoolArea&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s2">&quot;Fence&quot;</span><span class="p">:</span> <span class="s2">&quot;MnPrv&quot;</span><span class="p">,</span>
      <span class="s2">&quot;MiscVal&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s2">&quot;MoSold&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
      <span class="s2">&quot;YrSold&quot;</span><span class="p">:</span> <span class="mi">2010</span><span class="p">,</span>
      <span class="s2">&quot;SaleType&quot;</span><span class="p">:</span> <span class="s2">&quot;WD&quot;</span><span class="p">,</span>
      <span class="s2">&quot;SaleCondition&quot;</span><span class="p">:</span> <span class="s2">&quot;Normal&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>


<span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;http://house-prices-env.eba-kxppppph.us-east-1.elasticbeanstalk.com&#39;</span>
<span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s1">/api/v1/predict&#39;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
    &quot;errors&quot;: null,
    &quot;version&quot;: &quot;0.1.0&quot;,
    &quot;predictions&quot;: [
        113422.55344864173
    ]
}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="terminating-the-environment">
<h3>Terminating the environment<a class="headerlink" href="#terminating-the-environment" title="Permalink to this headline">¶</a></h3>
<p>Note that this service is accessible to anyone on the internet. This is a security risk. In actual production, the service should only be accessible to the intended users. Hence, we now terminate the application. This can be done by simply running <code class="docutils literal notranslate"><span class="pre">eb</span> <span class="pre">terminate</span> <span class="pre">house-prices-env</span></code> in the CLI:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>eb terminate house-prices-env
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>The environment &quot;house-prices-env&quot; and all associated instances will be terminated.
To confirm, type the environment name: house-prices-env
2022-05-12 21:54:53    INFO    terminateEnvironment is starting.
2022-05-12 21:55:11    INFO    Deleted CloudWatch alarm named: awseb-e-23gau7nwzi-stack-AWSEBCloudwatchAlarmHigh-J443745IGHJ1
2022-05-12 21:55:11    INFO    Deleted CloudWatch alarm named: awseb-e-23gau7nwzi-stack-AWSEBCloudwatchAlarmLow-MB18SO8WWYAQ
2022-05-12 21:55:11    INFO    Deleted Auto Scaling group policy named: arn:aws:autoscaling:us-east-1:886789456404:scalingPolicy:d7505a15-779c-443a-9177-e7f7fb014bb3:autoScalingGroupName/awseb-e-23gau7nwzi-stack-AWSEBAutoScalingGroup-5NOVWKOF9ZLC:policyName/awseb-e-23gau7nwzi-stack-AWSEBAutoScalingScaleUpPolicy-FUW2YBNF7V2M
2022-05-12 21:55:11    INFO    Deleted Auto Scaling group policy named: arn:aws:autoscaling:us-east-1:886789456404:scalingPolicy:35fc0640-05dd-4814-893c-f32bb0615313:autoScalingGroupName/awseb-e-23gau7nwzi-stack-AWSEBAutoScalingGroup-5NOVWKOF9ZLC:policyName/awseb-e-23gau7nwzi-stack-AWSEBAutoScalingScaleDownPolicy-15K1L1CIJDG7I
2022-05-12 21:55:11    INFO    Waiting for EC2 instances to terminate. This may take a few minutes.
2022-05-12 21:57:44    INFO    Deleted Auto Scaling group named: awseb-e-23gau7nwzi-stack-AWSEBAutoScalingGroup-5NOVWKOF9ZLC
2022-05-12 21:57:59    INFO    Deleted load balancer named: awseb-e-2-AWSEBLoa-1LYFCW64ZS7SZ
2022-05-12 21:58:00    INFO    Deleted Auto Scaling launch configuration named: awseb-e-23gau7nwzi-stack-AWSEBAutoScalingLaunchConfiguration-a5VmF3A2Bp0Y
2022-05-12 21:58:00    INFO    Deleted security group named: awseb-e-23gau7nwzi-stack-AWSEBSecurityGroup-DN3MPY78253L
2022-05-12 21:58:45    INFO    Deleted security group named: sg-0b2e76e66001617ea
2022-05-12 21:58:47    INFO    Deleting SNS topic for environment house-prices-env.
2022-05-12 21:58:52    INFO    terminateEnvironment completed successfully.
</pre></div>
</div>
<p><strong>Remark.</strong> The astute reader will notice that this is a different environment from above. Indeed, we recreated <code class="docutils literal notranslate"><span class="pre">house-prices-env</span></code> for the sake of demonstration.</p>
</div>
<div class="section" id="load-balancing">
<h3>Load balancing<a class="headerlink" href="#load-balancing" title="Permalink to this headline">¶</a></h3>
<p>EB performs automatic load balancing under the hood. It will add more instances of the service when there are lots of request during peak hours, and automatically removes instances when there are no more requests. Moreover, the load balancer listens for incoming HTTP traffic and distributes it to the multiple instances on the same port, so the requests are dealt with in an efficient manner. The same process can also restart the application if it crashes for any reason.</p>
<p>As a consequence of this automatic nature, applications should be designed to be <strong>stateless</strong>, as containers can be terminated and replaced at any time without your knowledge or involvement. For example, it should not store any data that will be used for future requests (recall that RESTful APIs adheres to this requirement).</p>
<div class="figure align-default" id="id5">
<a class="reference internal image-reference" href="../../_images/load-balancing.png"><img alt="../../_images/load-balancing.png" src="../../_images/load-balancing.png" style="width: 35em;" /></a>
<p class="caption"><span class="caption-number">Fig. 51 </span><span class="caption-text">EB automatically load balances by scaling up or scaling down the number of containers depending on the rate of requests. The load is distributed to the multiple instances of the application.</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/deployment"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="model-serving-api.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Prediction Serving API</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="cicd-pipelines.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Continuous Integration and Deployment Pipelines</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By 𝗥𝗼𝗻 𝗠𝗲𝗱𝗶𝗻𝗮. Powered by <a href="https://jupyterbook.org">Jupyter Book</a>.<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>